<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unimate Standalone Timetable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Emergency fallback styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .event-exam {
            border-left: 4px solid #f97316 !important;
        }

        .event-class {
            border-left: 4px solid #3b82f6 !important;
        }

        .event-urgent {
            border: 1px solid #ef4444 !important;
            background-color: #fef2f2 !important;
        }

        @media print {

            button,
            .print-hide {
                display: none !important;
            }
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h1 class="text-3xl font-bold mb-4">Unimate Standalone Timetable</h1>
            <p class="text-gray-600 mb-4">This page shows demo data without requiring backend login or WebSockets.</p>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4">Demo Timetable</h2>
            <div id="timetable" class="space-y-4"></div>
        </div>
    </div>

    <script>
        // Sample timetable data
        const demoEvents = [
            {
                "id": 1,
                "title": "ENGGEN205 Lecture",
                "event_type": "class",
                "course": { "code": "ENGGEN205", "name": "Engineering Mechanics" },
                "room": { "building": "ENG", "number": "340" },
                "start_time": new Date().toISOString(),
                "end_time": new Date(Date.now() + 3600000).toISOString(),
                "lecturer": "Dr. Smith",
                "is_urgent": false
            },
            {
                "id": 2,
                "title": "STATS100 Mid-term Exam",
                "event_type": "exam",
                "course": { "code": "STATS100", "name": "Statistics" },
                "room": { "building": "ENG", "number": "401" },
                "start_time": new Date(Date.now() + 86400000).toISOString(),
                "end_time": new Date(Date.now() + 86400000 + 7200000).toISOString(),
                "lecturer": "N/A",
                "is_urgent": true
            },
            {
                "id": 3,
                "title": "COMPSCI101 Lab",
                "event_type": "class",
                "course": { "code": "COMPSCI101", "name": "Computer Science" },
                "room": { "building": "SCI", "number": "201" },
                "start_time": new Date(Date.now() + 2 * 86400000).toISOString(),
                "end_time": new Date(Date.now() + 2 * 86400000 + 5400000).toISOString(),
                "lecturer": "Prof. Ada",
                "is_urgent": false
            }
        ];

        // Render timetable function
        function renderTimetable(events) {
            console.log("Rendering timetable with", events.length, "events");

            const timetable = document.getElementById('timetable');
            timetable.innerHTML = '';

            if (!events || events.length === 0) {
                timetable.innerHTML = '<p class="text-gray-500 text-center py-4">No upcoming events found.</p>';
                return;
            }

            events.forEach(event => {
                const eventElement = document.createElement('div');
                eventElement.className = 'p-4 border rounded-lg hover:bg-gray-50 cursor-pointer mb-3';

                // Add CSS classes based on event type and urgency
                if (event.event_type === 'exam') {
                    eventElement.classList.add('event-exam');
                } else {
                    eventElement.classList.add('event-class');
                }

                if (event.is_urgent) {
                    eventElement.classList.add('event-urgent');
                }

                // Format date and time
                const startTime = new Date(event.start_time);
                const endTime = new Date(event.end_time);
                const dateOptions = { weekday: 'short', month: 'short', day: 'numeric' };
                const timeOptions = { hour: '2-digit', minute: '2-digit' };

                // Course code and room number handling
                const courseCode = event.course && event.course.code ? event.course.code : 'N/A';
                const roomInfo = event.room ?
                    `${event.room.building || ''} ${event.room.number || ''}`.trim() :
                    'TBA';

                const eventTypeLabel = event.event_type === 'exam' ? 'EXAM' : 'CLASS';
                const eventTypeClass = event.event_type === 'exam' ? 'bg-orange-100 text-orange-800' : 'bg-blue-100 text-blue-800';

                eventElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <h3 class="font-bold text-lg">${event.title || 'Untitled Event'}</h3>
                                <span class="px-2 py-0.5 text-xs font-semibold rounded ${eventTypeClass}">${eventTypeLabel}</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">${courseCode} - ${roomInfo}</p>
                            <p class="text-sm text-gray-500">
                                ${startTime.toLocaleDateString(undefined, dateOptions)} •
                                ${startTime.toLocaleTimeString(undefined, timeOptions)} - ${endTime.toLocaleTimeString(undefined, timeOptions)}
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium text-gray-700">${event.lecturer || 'No lecturer'}</p>
                            ${event.is_urgent ? '<span class="text-xs bg-red-500 text-white px-2 py-0.5 rounded">Urgent</span>' : ''}
                        </div>
                    </div>
                `;

                // Add click handler to show event details
                eventElement.addEventListener('click', function() {
                    showEventDetails(event);
                });

                timetable.appendChild(eventElement);
            });

            // Add a print button
            const printButton = document.createElement('button');
            printButton.className = 'mt-4 bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded w-full';
            printButton.textContent = 'Print Timetable';
            printButton.addEventListener('click', () => {
                window.print();
            });
            timetable.appendChild(printButton);
        }

        // Event Details Modal Functions
        function showEventDetails(event) {
            // Create modal if it doesn't exist
            let modal = document.getElementById('event-details-modal');
            if (!modal) {
                modal = createEventDetailsModal();
                document.body.appendChild(modal);
            }

            // Populate modal with event data
            populateEventModal(modal, event);
            
            // Show the modal
            modal.style.display = 'flex';
            
            // Add event listener to close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    hideEventDetailsModal();
                }
            });

            // Add keyboard listener to close modal with Escape key
            document.addEventListener('keydown', function escapeHandler(e) {
                if (e.key === 'Escape') {
                    hideEventDetailsModal();
                    document.removeEventListener('keydown', escapeHandler);
                }
            });

        function createEventDetailsModal() {
            const modal = document.createElement('div');
            modal.id = 'event-details-modal';
            modal.className = 'modal-overlay';
            modal.setAttribute('role', 'dialog');
            modal.setAttribute('aria-modal', 'true');
            modal.setAttribute('aria-labelledby', 'modal-event-title');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.7);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;

            const modalContent = document.createElement('div');
            modalContent.className = 'event-modal-content';
            modalContent.style.cssText = `
                background-color: #2a2a2a;
                padding: 2rem;
                border-radius: 0.5rem;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
                width: 100%;
                max-width: 28rem;
                color: #fff;
                position: relative;
                max-height: 80vh;
                overflow-y: auto;
            `;

            modalContent.innerHTML = `
                <button class="modal-close-btn" style="
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    background: none;
                    border: none;
                    color: #aaa;
                    font-size: 1.5rem;
                    cursor: pointer;
                    padding: 0;
                    width: 30px;
                    height: 30px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">&times;</button>
                
                <div class="event-header" style="margin-bottom: 1.5rem;">
                    <h2 id="modal-event-title" style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: bold;"></h2>
                    <span id="modal-event-type" style="
                        padding: 0.25rem 0.75rem;
                        border-radius: 0.375rem;
                        font-size: 0.75rem;
                        font-weight: 600;
                        display: inline-block;
                    "></span>
                </div>
                
                <div class="event-details" style="space-y: 1rem;">
                    <div class="detail-row" style="margin-bottom: 1rem;">
                        <strong style="display: block; margin-bottom: 0.25rem; color: #ccc;">Course:</strong>
                        <span id="modal-course-info"></span>
                    </div>
                    
                    <div class="detail-row" style="margin-bottom: 1rem;">
                        <strong style="display: block; margin-bottom: 0.25rem; color: #ccc;">Location:</strong>
                        <span id="modal-location-info"></span>
                    </div>
                    
                    <div class="detail-row" style="margin-bottom: 1rem;">
                        <strong style="display: block; margin-bottom: 0.25rem; color: #ccc;">Time:</strong>
                        <span id="modal-time-info"></span>
                    </div>
                    
                    <div class="detail-row" style="margin-bottom: 1rem;">
                        <strong style="display: block; margin-bottom: 0.25rem; color: #ccc;">Lecturer:</strong>
                        <span id="modal-lecturer-info"></span>
                    </div>
                </div>
                
                <div class="modal-actions" style="margin-top: 1.5rem; display: flex; gap: 0.5rem;">
                    <button id="modal-close-btn" style="
                        flex: 1;
                        background-color: #444;
                        color: white;
                        border: none;
                        padding: 0.75rem 1rem;
                        border-radius: 0.375rem;
                        cursor: pointer;
                        font-weight: 600;
                    ">Close</button>
                </div>
            `;

            modal.appendChild(modalContent);

            // Add event listeners for closing the modal
            modalContent.querySelector('.modal-close-btn').addEventListener('click', hideEventDetailsModal);
            modalContent.querySelector('#modal-close-btn').addEventListener('click', hideEventDetailsModal);

            return modal;
        }

        function populateEventModal(modal, event) {
            const title = modal.querySelector('#modal-event-title');
            const type = modal.querySelector('#modal-event-type');
            const course = modal.querySelector('#modal-course-info');
            const location = modal.querySelector('#modal-location-info');
            const time = modal.querySelector('#modal-time-info');
            const lecturer = modal.querySelector('#modal-lecturer-info');

            // Set title and clear any previous urgent badges
            title.innerHTML = '';
            title.textContent = event.title || 'Untitled Event';

            // Set event type with appropriate styling
            const eventTypeLabel = event.event_type === 'exam' ? 'EXAM' : 'CLASS';
            const typeColor = event.event_type === 'exam' ? '#f97316' : '#3b82f6';
            type.textContent = eventTypeLabel;
            type.style.backgroundColor = typeColor;
            type.style.color = 'white';

            // Set course info
            const courseCode = event.course && event.course.code ? event.course.code : 'N/A';
            const courseName = event.course && event.course.name ? event.course.name : '';
            course.textContent = courseName ? `${courseCode} - ${courseName}` : courseCode;

            // Set location
            const roomInfo = event.room ? 
                `${event.room.building || ''} ${event.room.number || ''}`.trim() : 
                'TBA';
            location.textContent = roomInfo;

            // Set time
            const startTime = new Date(event.start_time);
            const endTime = new Date(event.end_time);
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit' };
            time.textContent = `${startTime.toLocaleDateString(undefined, dateOptions)} • ${startTime.toLocaleTimeString(undefined, timeOptions)} - ${endTime.toLocaleTimeString(undefined, timeOptions)}`;

            // Set lecturer
            lecturer.textContent = event.lecturer || 'No lecturer assigned';

            // Add urgent styling if needed
            if (event.is_urgent) {
                const urgentBadge = document.createElement('span');
                urgentBadge.style.cssText = `
                    background-color: #ef4444;
                    color: white;
                    padding: 0.25rem 0.5rem;
                    border-radius: 0.375rem;
                    font-size: 0.75rem;
                    font-weight: 600;
                    margin-left: 0.5rem;
                `;
                urgentBadge.textContent = 'URGENT';
                title.appendChild(urgentBadge);
            }
        }

        function hideEventDetailsModal() {
            const modal = document.getElementById('event-details-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            console.log("Standalone page loaded");
            renderTimetable(demoEvents);
        });
    </script>
</body>

</html>