<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Popup Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: white;
            padding: 20px;
        }
        
        .test-event {
            background-color: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
            border: 1px solid #444;
        }
        
        .test-event:hover {
            background-color: #3a3a3a;
        }
    </style>
</head>
<body>
    <h1>Event Popup Test</h1>
    <p>Click on any event below to test the popup functionality:</p>
    
    <div class="test-event" onclick="testEvent1()">
        <strong>ENGGEN205 Lecture</strong><br>
        Engineering Building - Room 340<br>
        Today at 10:00 AM
    </div>
    
    <div class="test-event" onclick="testEvent2()">
        <strong>STATS100 Mid-term Exam (URGENT)</strong><br>
        Science Building - Room 201<br>
        Tomorrow at 2:00 PM
    </div>
    
    <div class="test-event" onclick="testEvent3()">
        <strong>CS101 Lab Session</strong><br>
        No location specified<br>
        Next week
    </div>

    <script>
        // Test event data
        const testEvents = {
            event1: {
                "id": 1,
                "title": "ENGGEN205 Lecture",
                "event_type": "class",
                "course": { "code": "ENGGEN205", "name": "Engineering Mechanics" },
                "room": { "building": "ENG", "number": "340" },
                "start_time": new Date().toISOString(),
                "end_time": new Date(Date.now() + 3600000).toISOString(),
                "lecturer": "Dr. Smith",
                "is_urgent": false
            },
            event2: {
                "id": 2,
                "title": "STATS100 Mid-term Exam",
                "event_type": "exam",
                "course": { "code": "STATS100", "name": "Statistics" },
                "room": { "building": "SCI", "number": "201" },
                "start_time": new Date(Date.now() + 86400000).toISOString(),
                "end_time": new Date(Date.now() + 86400000 + 7200000).toISOString(),
                "lecturer": "Prof. Johnson",
                "is_urgent": true
            },
            event3: {
                "id": 3,
                "title": "CS101 Lab Session",
                "event_type": "class",
                "course": { "code": "CS101", "name": "Introduction to Computer Science" },
                "room": null,
                "start_time": new Date(Date.now() + 604800000).toISOString(),
                "end_time": new Date(Date.now() + 604800000 + 7200000).toISOString(),
                "lecturer": null,
                "is_urgent": false
            }
        };

        function testEvent1() {
            showEventDetails(testEvents.event1);
        }

        function testEvent2() {
            showEventDetails(testEvents.event2);
        }

        function testEvent3() {
            showEventDetails(testEvents.event3);
        }

        // Include the showEventDetails function from app.js
        function showEventDetails(event) {
            // Create modal if it doesn't exist
            let modal = document.getElementById('event-details-modal');
            if (!modal) {
                modal = createEventDetailsModal();
                document.body.appendChild(modal);
            }

            // Populate modal with event data
            populateEventModal(modal, event);
            
            // Show the modal
            modal.style.display = 'flex';
            
            // Add event listener to close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    hideEventDetailsModal();
                }
            });

            // Add keyboard listener to close modal with Escape key
            document.addEventListener('keydown', function escapeHandler(e) {
                if (e.key === 'Escape') {
                    hideEventDetailsModal();
                    document.removeEventListener('keydown', escapeHandler);
                }
            });
        }

        function createEventDetailsModal() {
            const modal = document.createElement('div');
            modal.id = 'event-details-modal';
            modal.className = 'modal-overlay';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.7);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;

            const modalContent = document.createElement('div');
            modalContent.className = 'event-modal-content';
            modalContent.style.cssText = `
                background-color: #2a2a2a;
                padding: 2rem;
                border-radius: 0.5rem;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
                width: 100%;
                max-width: 28rem;
                color: #fff;
                position: relative;
                max-height: 80vh;
                overflow-y: auto;
            `;

            modalContent.innerHTML = `
                <button class="modal-close-btn" style="
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    background: none;
                    border: none;
                    color: #aaa;
                    font-size: 1.5rem;
                    cursor: pointer;
                    padding: 0;
                    width: 30px;
                    height: 30px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">&times;</button>
                
                <div class="event-header" style="margin-bottom: 1.5rem;">
                    <h2 id="modal-event-title" style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: bold;"></h2>
                    <span id="modal-event-type" style="
                        padding: 0.25rem 0.75rem;
                        border-radius: 0.375rem;
                        font-size: 0.75rem;
                        font-weight: 600;
                        display: inline-block;
                    "></span>
                </div>
                
                <div class="event-details" style="space-y: 1rem;">
                    <div class="detail-row" style="margin-bottom: 1rem;">
                        <strong style="display: block; margin-bottom: 0.25rem; color: #ccc;">Course:</strong>
                        <span id="modal-course-info"></span>
                    </div>
                    
                    <div class="detail-row" style="margin-bottom: 1rem;">
                        <strong style="display: block; margin-bottom: 0.25rem; color: #ccc;">Location:</strong>
                        <span id="modal-location-info"></span>
                    </div>
                    
                    <div class="detail-row" style="margin-bottom: 1rem;">
                        <strong style="display: block; margin-bottom: 0.25rem; color: #ccc;">Time:</strong>
                        <span id="modal-time-info"></span>
                    </div>
                    
                    <div class="detail-row" style="margin-bottom: 1rem;">
                        <strong style="display: block; margin-bottom: 0.25rem; color: #ccc;">Lecturer:</strong>
                        <span id="modal-lecturer-info"></span>
                    </div>
                </div>
                
                <div class="modal-actions" style="margin-top: 1.5rem; display: flex; gap: 0.5rem;">
                    <button id="modal-navigate-btn" style="
                        flex: 1;
                        background-color: #5473e8;
                        color: white;
                        border: none;
                        padding: 0.75rem 1rem;
                        border-radius: 0.375rem;
                        cursor: pointer;
                        font-weight: 600;
                    ">Navigate</button>
                    <button id="modal-close-btn" style="
                        flex: 1;
                        background-color: #444;
                        color: white;
                        border: none;
                        padding: 0.75rem 1rem;
                        border-radius: 0.375rem;
                        cursor: pointer;
                        font-weight: 600;
                    ">Close</button>
                </div>
            `;

            modal.appendChild(modalContent);

            // Add event listeners for closing the modal
            modalContent.querySelector('.modal-close-btn').addEventListener('click', hideEventDetailsModal);
            modalContent.querySelector('#modal-close-btn').addEventListener('click', hideEventDetailsModal);

            return modal;
        }

        function populateEventModal(modal, event) {
            const title = modal.querySelector('#modal-event-title');
            const type = modal.querySelector('#modal-event-type');
            const course = modal.querySelector('#modal-course-info');
            const location = modal.querySelector('#modal-location-info');
            const time = modal.querySelector('#modal-time-info');
            const lecturer = modal.querySelector('#modal-lecturer-info');
            const navigateBtn = modal.querySelector('#modal-navigate-btn');

            // Set title and clear any previous urgent badges
            title.innerHTML = '';
            title.textContent = event.title || 'Untitled Event';

            // Set event type with appropriate styling
            const eventTypeLabel = event.event_type === 'exam' ? 'EXAM' : 'CLASS';
            const typeColor = event.event_type === 'exam' ? '#f97316' : '#3b82f6';
            type.textContent = eventTypeLabel;
            type.style.backgroundColor = typeColor;
            type.style.color = 'white';

            // Set course info
            const courseCode = event.course && event.course.code ? event.course.code : 'N/A';
            const courseName = event.course && event.course.name ? event.course.name : '';
            course.textContent = courseName ? `${courseCode} - ${courseName}` : courseCode;

            // Set location
            const roomInfo = event.room ? 
                `${event.room.building || ''} ${event.room.number || ''}`.trim() : 
                'TBA';
            location.textContent = roomInfo;

            // Set time
            const startTime = new Date(event.start_time);
            const endTime = new Date(event.end_time);
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit' };
            time.textContent = `${startTime.toLocaleDateString(undefined, dateOptions)} â€¢ ${startTime.toLocaleTimeString(undefined, timeOptions)} - ${endTime.toLocaleTimeString(undefined, timeOptions)}`;

            // Set lecturer
            lecturer.textContent = event.lecturer || 'No lecturer assigned';

            // Handle navigate button
            if (event.room) {
                navigateBtn.style.display = 'block';
                navigateBtn.onclick = function() {
                    hideEventDetailsModal();
                    alert('Navigation would be triggered here for: ' + roomInfo);
                };
            } else {
                navigateBtn.style.display = 'none';
            }

            // Add urgent styling if needed
            if (event.is_urgent) {
                const urgentBadge = document.createElement('span');
                urgentBadge.style.cssText = `
                    background-color: #ef4444;
                    color: white;
                    padding: 0.25rem 0.5rem;
                    border-radius: 0.375rem;
                    font-size: 0.75rem;
                    font-weight: 600;
                    margin-left: 0.5rem;
                `;
                urgentBadge.textContent = 'URGENT';
                title.appendChild(urgentBadge);
            }
        }

        function hideEventDetailsModal() {
            const modal = document.getElementById('event-details-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>